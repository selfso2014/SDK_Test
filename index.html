<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <title>SeeSo Reading Game â€“ Debug</title>
    <meta name="description" content="SeeSo Eye Tracking ê¸°ë°˜ ë¦¬ë”© ê²Œì„ (iPhone í¬ë˜ì‹œ ë””ë²„ê·¸ìš©)" />
    <link rel="stylesheet" href="style.css" />
</head>

<body>

    <div id="app">

        <!-- â”€â”€ Header Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div id="header-bar">
            <h1>ğŸ‘ï¸ SeeSo Reading Game <span style="font-size:10px;color:#555;font-weight:400;">[DEBUG]</span></h1>
            <div id="header-stats">
                <span>Gaze: <b id="gaze-fps">0</b> Hz</span>
                <span>
                    <button id="btn-download-log"
                        style="background:#1a1a3a;color:#88aaff;border:1px solid #334;border-radius:4px;padding:2px 8px;cursor:pointer;font-size:11px;">ğŸ“¥
                        ë¡œê·¸ ì €ì¥</button>
                </span>
            </div>
        </div>

        <!-- â”€â”€ Section: IDLE (ì‹œì‘ í™”ë©´) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section id="section-idle" class="game-section active">
            <div class="idle-logo">ğŸ“–</div>
            <div class="idle-title">SeeSo ë¦¬ë”© ê²Œì„</div>
            <div class="idle-subtitle">Eye Tracking Reading Test Â· Debug Build</div>

            <div class="idle-badges">
                <span class="badge">ğŸ‘ï¸ 1-Point Calibration</span>
                <span class="badge">ğŸ“Š Memory Monitor</span>
                <span class="badge">ğŸ iOS Debug Mode</span>
            </div>

            <p class="idle-desc">
                ì‹œì„  ì¶”ì  ê¸°ìˆ ì„ ì´ìš©í•˜ì—¬ ì§€ë¬¸ì„ ì½ê³  ë¬¸ì œë¥¼ í’€ì–´ë³´ì„¸ìš”.<br />
                ì¹´ë©”ë¼ ê¶Œí•œê³¼ HTTPS í™˜ê²½ì´ í•„ìš”í•©ë‹ˆë‹¤.
            </p>

            <div style="margin-top:8px;">
                <button id="btn-start" class="btn btn-primary">
                    ğŸš€ ê²Œì„ ì‹œì‘
                </button>
            </div>
        </section>

        <!-- â”€â”€ Section: LOADING (SDK ì´ˆê¸°í™”) â”€â”€â”€â”€ -->
        <section id="section-loading" class="game-section">
            <div class="loading-spinner"></div>
            <div class="loading-label">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”</div>
            <div class="loading-hint">AI ëª¨ë¸ì„ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤.<br />ì²« ì‹¤í–‰ ì‹œ ë„¤íŠ¸ì›Œí¬ ì†ë„ì— ë”°ë¼ 30ì´ˆê¹Œì§€ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
        </section>

        <!-- â”€â”€ Section: CALIBRATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section id="section-calibration" class="game-section">
            <div id="cal-instruction">
                <h2>ğŸ¯ ì‹œì„  ìº˜ë¦¬ë¸Œë ˆì´ì…˜</h2>
                <p>í™”ë©´ì— ë‚˜íƒ€ë‚˜ëŠ” ì ì„ ì‘ì‹œí•´ ì£¼ì„¸ìš”</p>
            </div>
            <div id="cal-progress-wrap">
                <div id="cal-progress-track">
                    <div id="cal-progress-bar"></div>
                </div>
                <div id="cal-progress-text">0%</div>
            </div>
            <div id="cal-dot"></div>
        </section>

        <!-- â”€â”€ Section: READING (ì§€ë¬¸ ì½ê¸°) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section id="section-reading" class="game-section">
            <h2 id="reading-title" style="font-size:20px;font-weight:700;color:#58a6ff;text-align:center;"></h2>
            <div id="reading-text-wrap">
                <p id="reading-text"></p>
            </div>
            <div class="reading-actions">
                <button id="btn-go-quiz" class="btn btn-primary">
                    ë‹¤ ì½ì—ˆì–´ìš” â†’ ë¬¸ì œ í’€ê¸°
                </button>
            </div>
        </section>

        <!-- â”€â”€ Section: QUIZ (ë¬¸ì œ í’€ê¸°) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section id="section-quiz" class="game-section">
            <div id="quiz-question-wrap">
                <p id="quiz-question"></p>
            </div>
            <div id="quiz-options"></div>
        </section>

        <!-- â”€â”€ Section: RESULT (ê²°ê³¼) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section id="section-result" class="game-section">
            <div class="result-emoji">ğŸ†</div>
            <div class="result-title">ê²Œì„ ì™„ë£Œ!</div>
            <div id="result-score">0 / 0</div>
            <div id="result-msg"></div>
            <div class="result-actions" style="margin-top:16px;">
                <button id="btn-play-again" class="btn btn-primary">ğŸ”„ ë‹¤ì‹œí•˜ê¸°</button>
                <button class="btn btn-secondary" onclick="MemoryLogger.downloadLogs()">ğŸ“¥ ë¡œê·¸ ì €ì¥</button>
            </div>
        </section>

        <!-- â”€â”€ Gaze Dot Overlay Canvas â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <canvas id="gaze-canvas"></canvas>

        <!-- â”€â”€ ì¬ì‹œë„ ë²„íŠ¼ (ì—ëŸ¬ ì‹œ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <button id="btn-retry" class="btn btn-danger">ğŸ”„ ë‹¤ì‹œ ì‹œë„</button>

        <!-- â”€â”€ Status Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div id="status-text">ì¤€ë¹„ ì¤‘...</div>

    </div><!-- /#app -->

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì „ëµ:

  ë¬¸ì œ: easy-seeso.jsëŠ” ES Module importë¡œ seeso.jsë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ë§Œ,
       seeso.jsëŠ” Webpack IIFE ë²ˆë“¤(ë¹„ ESM)ì´ë¼ import ë¶ˆê°€ â†’ ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨.

  í•´ê²°: seeso.jsë¥¼ ì¼ë°˜ <script>ë¡œ ë¨¼ì € ë¡œë“œ â†’ ì „ì—­ Seeso í´ë˜ìŠ¤ë¥¼ windowì— ë“±ë¡.
        easy-seeso.jsëŠ” window.Seesoë¥¼ ì‚¬ìš©í•˜ë„ë¡ íŒ¨ì¹˜ëœ ì¸ë¼ì¸ ë²„ì „ ì‚¬ìš©.
        ë‚˜ë¨¸ì§€(passage-data, seeso-manager, game)ëŠ” ì¼ë°˜ <script> ìˆœì°¨ ë¡œë“œ.

  ë¡œë“œ ìˆœì„œ:
  1. memory-logger.js        â† ì—ëŸ¬ ìºì¹˜ ì¤€ë¹„ (ê°€ì¥ ë¨¼ì €)
  2. dist/seeso.min.js       â† Seeso ì „ì—­ í´ë˜ìŠ¤ ë“±ë¡
  3. easy-seeso-patched.js   â† window.Seeso ì‚¬ìš©í•˜ëŠ” EasySeeso ì¸ë¼ì¸
  4. passage-data.js
  5. seeso-manager.js
  6. game.js
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

    <!-- 1. ë©”ëª¨ë¦¬ ë¡œê±° (ê°€ì¥ ë¨¼ì €) -->
    <script src="memory-logger.js"></script>

    <!-- 2. SeeSo SDK ì½”ì–´ (ì „ì—­ Seeso ë“±ë¡) -->
    <script src="dist/seeso.min.js"></script>

    <!-- 3. EasySeeso ë˜í¼ (window.Seeso ì˜ì¡´ â€” import ë°©ì‹ ëŒ€ì‹  ì „ì—­ ì°¸ì¡°) -->
    <script>
        // easy-seeso.jsì˜ í•µì‹¬ì„ ì¸ë¼ì¸ìœ¼ë¡œ ì¬í˜„.
        // ì›ë³¸ì€ 'import Seeso from ./dist/seeso' ESM importë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ
        // seeso.min.jsëŠ” Webpack IIFE ë²ˆë“¤ì´ë¼ ESM import ë¶ˆê°€.
        // ëŒ€ì‹  ìœ„ì—ì„œ <script src="dist/seeso.min.js"> ë¡œë“œ í›„
        // windowì— ë“±ë¡ëœ Seeso í´ë˜ìŠ¤ë¥¼ ì°¸ì¡°í•œë‹¤.
        (function () {
            // dist/seeso.min.js ë¡œë“œ í›„ Seeso, InitializationErrorType, CalibrationAccuracyCriteriaê°€
            // ì–´ë–¤ ì´ë¦„ìœ¼ë¡œ globalì— ë…¸ì¶œë˜ëŠ”ì§€ í™•ì¸ í›„ EasySeesoì— ì—°ê²°.
            // seeso.min.jsì˜ export: module.exports ë˜ëŠ” window ì „ì—­ì— ë“±ë¡ë  ê°€ëŠ¥ì„±.
            // ì‹¤ì œ ë²ˆë“¤ ë‚´ë¶€ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ë¨¼ì € ë¡œê¹….
            const keys = Object.keys(window).filter(k =>
                k === 'Seeso' || k === 'EasySeeso' || k === 'InitializationErrorType' ||
                k === 'CalibrationAccuracyCriteria' || k === 'seeso'
            );
            MemoryLogger.info('BOOT', 'After seeso.min.js load, window keys found:', { keys });
            MemoryLogger.info('BOOT', 'typeof window.Seeso: ' + typeof window.Seeso);
            MemoryLogger.info('BOOT', 'typeof module: ' + (typeof module !== 'undefined' ? 'defined' : 'undefined'));
        })();
    </script>

    <!-- 4. easy-seeso.js â†’ ES Moduleì´ë¯€ë¡œ type="module"ë¡œ ë¡œë“œ í›„ windowì— ë…¸ì¶œ -->
    <script type="module">
        try {
            // seeso.min.jsê°€ ì „ì—­ Seesoë¥¼ ë…¸ì¶œí•˜ì§€ ì•Šì„ ê²½ìš°ë¥¼ ëŒ€ë¹„,
            // easy-seeso.jsì˜ importê°€ ì‹¤íŒ¨í•˜ë©´ ëŒ€ì²´ ê²½ë¡œë¥¼ ì‚¬ìš©.
            const mod = await import('./easy-seeso.js');
            window.EasySeeso = mod.default;
            MemoryLogger.info('BOOT', 'EasySeeso loaded via ESM import âœ…', { type: typeof window.EasySeeso });
        } catch (e) {
            MemoryLogger.error('BOOT', 'ESM import of easy-seeso.js FAILED', { msg: e.message, stack: e.stack });
            // ESM ì‹¤íŒ¨ â†’ Seeso ì „ì—­ì´ ìˆìœ¼ë©´ ì§ì ‘ ìµœì†Œ EasySeeso êµ¬í˜„
            if (typeof window.Seeso !== 'undefined') {
                MemoryLogger.warn('BOOT', 'Falling back to direct Seeso global usage');
            }
        }

        // ë‚˜ë¨¸ì§€ ìŠ¤í¬ë¦½íŠ¸ ìˆœì°¨ ë¡œë“œ
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const s = document.createElement('script');
                s.src = src;
                s.onload = () => { MemoryLogger.info('BOOT', `Loaded: ${src}`); resolve(); };
                s.onerror = (err) => { MemoryLogger.error('BOOT', `Failed to load: ${src}`); reject(err); };
                document.body.appendChild(s);
            });
        }

        try {
            await loadScript('passage-data.js');
            await loadScript('seeso-manager.js');
            await loadScript('game.js');
            MemoryLogger.info('BOOT', 'âœ… All game scripts loaded');
        } catch (e) {
            MemoryLogger.error('BOOT', 'Script load chain failed', { msg: e.message });
            document.getElementById('status-text').textContent = 'âŒ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨. ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
        }
    </script>

</body>

</html>